
library(microbenchmark)
library(ggplot2)
n <- c()
iter <- c()
time_pass <- vector("list",length = 10)
for (i in 5:14){
  A11 <- matrix(runif(i^2),i,i)
  A12 <- diag(1,i,i)
  ##A13 <- matrix(0,4,4)
  A21 <- diag(1,i,i)
  A22 <- diag(1,i,i)
  B11 <- diag(1,i,i)
  B12 <- matrix(runif(i^2),i,i)
  B21 <- diag(1,i,i)
  B22 <- diag(-1,i,i)
  C1 <- matrix(c(1:i),i,i)
  C2 <- matrix(0,i,i)
  C <- list(C1,C2)
  A <- list(A11,A12,A21,A22)
  B <- list(B11,B12,B21,B22)
  #iter <- c(iter,general_CG(A,B,C)[[2]])
  time_pass[[i-4]] <- microbenchmark(general_CG(A,B,C))
  #n <- c(n,i^2)
}
n <- 2*n
plot(n,iter)
autoplot(time_pass[[1]],time_pass[[2]])

i <- 5
A11 <- matrix(runif(i^2),i,i)
A12 <- diag(1,i,i)
##A13 <- matrix(0,4,4)
A21 <- diag(1,i,i)
A22 <- diag(1,i,i)
B11 <- diag(1,i,i)
B12 <- matrix(runif(i^2),i,i)
B21 <- diag(1,i,i)
B22 <- diag(-1,i,i)
C1 <- matrix(c(1:i),i,i)
C2 <- matrix(0,i,i)
C_5 <- list(C1,C2)
A_5 <- list(A11,A12,A21,A22)
B_5 <- list(B11,B12,B21,B22)

i <- 6
A11 <- matrix(runif(i^2),i,i)
A12 <- diag(1,i,i)
##A13 <- matrix(0,4,4)
A21 <- diag(1,i,i)
A22 <- diag(1,i,i)
B11 <- diag(1,i,i)
B12 <- matrix(runif(i^2),i,i)
B21 <- diag(1,i,i)
B22 <- diag(-1,i,i)
C1 <- matrix(c(1:i),i,i)
C2 <- matrix(0,i,i)
C_6 <- list(C1,C2)
A_6 <- list(A11,A12,A21,A22)
B_6 <- list(B11,B12,B21,B22)

i <- 7
A11 <- matrix(runif(i^2),i,i)
A12 <- diag(1,i,i)
##A13 <- matrix(0,4,4)
A21 <- diag(1,i,i)
A22 <- diag(1,i,i)
B11 <- diag(1,i,i)
B12 <- matrix(runif(i^2),i,i)
B21 <- diag(1,i,i)
B22 <- diag(-1,i,i)
C1 <- matrix(c(1:i),i,i)
C2 <- matrix(0,i,i)
C_7 <- list(C1,C2)
A_7 <- list(A11,A12,A21,A22)
B_7 <- list(B11,B12,B21,B22)

i <- 8
A11 <- matrix(runif(i^2),i,i)
A12 <- diag(1,i,i)
##A13 <- matrix(0,4,4)
A21 <- diag(1,i,i)
A22 <- diag(1,i,i)
B11 <- diag(1,i,i)
B12 <- matrix(runif(i^2),i,i)
B21 <- diag(1,i,i)
B22 <- diag(-1,i,i)
C1 <- matrix(c(1:i),i,i)
C2 <- matrix(0,i,i)
C_8 <- list(C1,C2)
A_8 <- list(A11,A12,A21,A22)
B_8 <- list(B11,B12,B21,B22)

i <- 9
A11 <- matrix(runif(i^2),i,i)
A12 <- diag(1,i,i)
##A13 <- matrix(0,4,4)
A21 <- diag(1,i,i)
A22 <- diag(1,i,i)
B11 <- diag(1,i,i)
B12 <- matrix(runif(i^2),i,i)
B21 <- diag(1,i,i)
B22 <- diag(-1,i,i)
C1 <- matrix(c(1:i),i,i)
C2 <- matrix(0,i,i)
C_9 <- list(C1,C2)
A_9 <- list(A11,A12,A21,A22)
B_9 <- list(B11,B12,B21,B22)
time_pass <- microbenchmark(general_CG(A_5,B_5,C_5),general_CG(A_6,B_6,C_6),general_CG(A_7,B_7,C_7),
               general_CG(A_8,B_8,C_8),general_CG(A_9,B_9,C_9))

i <- 30
A11 <- matrix(runif(i^2),i,i)
A12 <- diag(1,i,i)
A21 <- diag(1,i,i)
A22 <- diag(1,i,i)
B11 <- diag(1,i,i)
B12 <- matrix(runif(i^2),i,i)
B21 <- diag(1,i,i)
B22 <- diag(-1,i,i)
C1 <- matrix(c(1:i),i,i)
C2 <- matrix(0,i,i)
C_30 <- list(C1,C2)
A_30 <- list(A11,A12,A21,A22)
B_30 <- list(B11,B12,B21,B22)

autoplot(time_pass)
overall_time <- summary(time_pass)[,4]
n <- c(5:9)^2*2
plot(n^2,overall_time)

## 1st order equation
i <- 20
A11 <- matrix(runif(i^2),i,i)
B11 <- matrix(runif(i^2),i,i)
C1 <- matrix(c(1:i),i,i)
C <- list(C1)
A <- list(A11)
B <- list(B11)
X <- general_CG(A,B,C,max.iter =  100000)
my_solve <- function(A11,B11){
  A_solve <- kronecker(t(B11),A11)
  b_solve <- as.vector(C1)
  X_vec <- solve(A_solve,b_solve)
  #dim(X_vec) <- c(i,i)
  return(X_vec)
}
microbenchmark(general_CG(A,B,C,max.iter =  100000)[[1]][[1]],my_solve(A11,B11))